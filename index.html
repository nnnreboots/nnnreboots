<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NNN Reboot Card Database</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-sA+e2Ck9zGQWkHkF4lCZuC2xJ7DP5+9X+MMbYHLvQ2Y=" crossorigin=""/>

</head>
<body>
<div id="map" style="width: 100%; height: 600px;"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-VueE+5pgPOO0B5XbKz9ycQkPgT6dr8w24MEC0W0H+0c=" crossorigin=""></script>

<!-- TopoJSON plugin -->
<script src="https://unpkg.com/topojson-client@3/dist/topojson.min.js"></script>

<script>
// Initialize map
const map = L.map('map', { zoomControl: true }).setView([20, 0], 2);

// Gray tile layer (basemap)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

// Storage & server nodes
const nodes = [
    { type: 'storage', name: 'Singapore', coords: [1.3521, 103.8198] },
    { type: 'server', name: 'China', coords: [35.8617, 104.1954] },
    { type: 'storage', name: 'Indonesia', coords: [-6.2, 106.8167] },
    { type: 'server', name: 'Japan', coords: [35.6762, 139.6503] },
    { type: 'server', name: 'Germany', coords: [51.1657, 10.4515] },
    { type: 'storage', name: 'UK', coords: [55.3781, -3.436] },
    { type: 'server', name: 'Poland', coords: [51.9194, 19.1451] },
    { type: 'server', name: 'USA East', coords: [37.0902, -95.7129] },
    { type: 'storage', name: 'USA West', coords: [36.7783, -119.4179] },
    { type: 'server', name: 'Mexico', coords: [23.6345, -102.5528] },
    { type: 'server', name: 'Brazil', coords: [-14.235, -51.9253] },
    { type: 'storage', name: 'Chile', coords: [-35.6751, -71.543] },
    { type: 'server', name: 'Australia', coords: [-25.2744, 133.7751] },
    { type: 'storage', name: 'New Zealand', coords: [-40.9006, 174.886] }
];

// Add markers
nodes.forEach(node => {
    const color = node.type === 'server' ? '#00bfff' : '#00ff85';
    const marker = L.circleMarker(node.coords, {
        radius: 8,
        color: color,
        fillColor: color,
        fillOpacity: 0.9,
        weight: 1,
        className: 'glow-marker'
    }).addTo(map);

    marker.bindPopup(`<b>${node.name}</b><br>Calculating latency...`);

    marker.on('click', () => {
        if (!navigator.geolocation) {
            marker.setPopupContent(`<b>${node.name}</b><br>Latency: N/A`);
            return;
        }
        navigator.geolocation.getCurrentPosition(pos => {
            const user = [pos.coords.latitude, pos.coords.longitude];
            const distance = haversine(user, node.coords);
            const latency = Math.round(distance / 200);
            marker.setPopupContent(`<b>${node.name}</b><br>Approx. Latency: ${latency} ms`);
        });
    });
});

// Haversine formula
function haversine(coord1, coord2) {
    const R = 6371;
    const dLat = (coord2[0] - coord1[0]) * Math.PI / 180;
    const dLon = (coord2[1] - coord1[1]) * Math.PI / 180;
    const a = Math.sin(dLat / 2)**2 +
        Math.cos(coord1[0] * Math.PI / 180) *
        Math.cos(coord2[0] * Math.PI / 180) *
        Math.sin(dLon / 2)**2;
    return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

// Load GeoJSON world countries
fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
.then(res => res.json())
.then(data => {
    L.geoJSON(data, {
        style: {
            color: '#888',
            weight: 1,
            fillColor: '#ccc',
            fillOpacity: 0.5
        }
    }).addTo(map);
});
</script>
</body>
</html>
